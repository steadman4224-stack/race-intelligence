<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Troyâ€™s RacePad</title>

<style>
:root {
  --bg: #111;
  --card: #1e1e1e;
  --text: #eee;
  --good: #2ecc71;
  --bad: #e74c3c;
}

.light {
  --bg: #f4f4f4;
  --card: #ffffff;
  --text: #111;
}

body {
  margin: 0;
  font-family: sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  padding: 12px;
  display: flex;
  justify-content: space-between;
}

select, button {
  padding: 6px;
  margin: 4px 0;
}

.card {
  background: var(--card);
  margin: 8px;
  padding: 12px;
  border-radius: 10px;
}

.good { color: var(--good); }
.bad { color: var(--bad); }
</style>
</head>

<body>
<header>
  <div>
    <select id="trackFilter"></select>
    <select id="raceFilter"></select>
  </div>
  <button onclick="toggleTheme()">ðŸŒ“</button>
</header>

<div id="cards">Loadingâ€¦</div>

<script>
const SUPABASE_URL = "https://jpzednbynpmcnmcpgdyp.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpwemVkbmJ5bnBtY25tY3BnZHlwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2ODAzODYsImV4cCI6MjA4MTI1NjM4Nn0.3elsp_7G4_ZIa0Z2Zsq-wi8BXbSV47Z6MTS6717XfvY";

let data = [];

function toggleTheme() {
  document.body.classList.toggle("light");
}

function speedClass(run, par) {
  if (!run || !par) return "";
  return run <= par ? "good" : "bad";
}

function render() {
  const track = trackFilter.value;
  const race = raceFilter.value;

  document.getElementById("cards").innerHTML =
    data
    .filter(r => (!track || r.track === track))
    .filter(r => (!race || r.race_number == race))
    .map(r => `
      <div class="card">
        <b>${r.horse}</b><br>
        Track: ${r.track} | Race ${r.race_number}<br>
        Barrier: ${r.barrier} | Jockey: ${r.jockey}<br>
        BM: ${r.benchmark} | Odds: ${r.odds}<br>
        <span class="${speedClass(r.run_time, r.par_time)}">
          Time: ${r.run_time}s (Par: ${r.par_time}s)
        </span>
      </div>
    `).join("");
}

fetch(`${SUPABASE_URL}/rest/v1/race_cards`, {
  headers: {
    apikey: SUPABASE_KEY,
    Authorization: `Bearer ${SUPABASE_KEY}`
  }
})
.then(r => r.json())
.then(rows => {
  data = rows;

  const tracks = [...new Set(rows.map(r => r.track))];
  trackFilter.innerHTML = `<option value="">All Tracks</option>` +
    tracks.map(t => `<option>${t}</option>`).join("");

  const races = [...new Set(rows.map(r => r.race_number))];
  raceFilter.innerHTML = `<option value="">All Races</option>` +
    races.map(r => `<option>${r}</option>`).join("");

  trackFilter.onchange = raceFilter.onchange = render;
  render();
});
</script>
</body>
</html>
